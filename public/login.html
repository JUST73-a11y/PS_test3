<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="utf-8" />
    <title>Login — PS Club</title>
    <link rel="icon" href="./logo.png" />
    <link rel="stylesheet" href="/shared.css" />
    <style>
        /* Login sahifasida nav-bar ko‘rinmasin */
        #ps-nav {
            display: none !important;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="card" style="      
            margin-top: 65%;
    background: rgb(24 28 44);">
            <h2 style="font-size: 45px; margin-bottom: 20px;"> Admin Kirish</h2>
            <label class="small">Username</label>
            <input id="username" style="width:100%; font-size: 40px; border: 1px solid #8d51c7; margin-bottom: 35px;"
                placeholder="Username" />
            <label class="small">Password</label>
            <input id="password" type="password"
                style="width:100%; font-size: 40px; border: 1px solid #8d51c7; margin-bottom: 35px;"
                placeholder="Password" />
            <div style="margin-top:8px">
                <button id="loginBtn" class="btn btn-primary">Kirish</button>
            </div>
        </div>
    </div>
    <div id="loading" style="display:none;text-align:center;margin:20px;">
        <!-- Spinner icon SVG -->
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
            <circle cx="24" cy="24" r="20" stroke="#8d51c7" stroke-width="6" opacity="0.2" />
            <path d="M44 24a20 20 0 1 1-20-20" stroke="#8d51c7" stroke-width="6" stroke-linecap="round" />
        </svg>
        <div>Yuklanmoqda...</div>
    </div>

    <script src="/app.js"></script>
    <script>
        document.getElementById("loginBtn").addEventListener("click", async () => {
            const u = document.getElementById("username").value;
            const p = document.getElementById("password").value;
            document.getElementById("loading").style.display = "block";
            try {
                const res = await fetch("/api/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username: u, password: p })
                });
                const j = await res.json();
                document.getElementById("loading").style.display = "none";
                if (j.ok && j.token) {
                    localStorage.setItem("ps_token", j.token);
                    window.location.href = "/dashboard.html";
                } else {
                    alert("Login xato: " + (j.error || JSON.stringify(j)));
                }
            } catch (e) {
                document.getElementById("loading").style.display = "none";
                console.error(e);
                alert("Serverga ulanishda xatolik");
            }
        });
    </script>
</body>

</html>